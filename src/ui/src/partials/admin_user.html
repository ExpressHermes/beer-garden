<h1 class='page-header'>
  <span>User Management</span>
</h1>

<fetch-data response="response"></fetch-data>

<div class="container-fluid animate-if"
     ng-show="responseState(response) === 'success'">
  <div ng-show="!config.authEnabled" uib-alert class="alert alert-danger">
    Warning - Beergarden authorization is currently disabled. Changes made here
    will be persisted, but permissions will not be enforced. Contact your
    administator to enable this feature.
  </div>
  <div class="row">
    <div class="col-md-2">
      <h3 style="text-align: center;">Users</h3>
    </div>
    <div class="col-md-2">
      <h3 style="text-align: center;">Roles</h3>
    </div>
    <div class="col-md-8">
      <h3 style="text-align: center;">Effective Permissions</h3>
    </div>
  </div>
  <form>
    <div class="row form-group">
      <div class="col-md-2">
        <select class="w-100" size="{{users.length}}"
          title="Select User"
          ng-model="selectedUser"
          ng-options="user.username for user in users"
          ng-change="setRoles()">
        </select>

      </div>
      <div class="col-md-2">
        <div ng-repeat="role in roles">
          <input type="checkbox" id="{{role.name}}"
            ng-model="selectedRoles[role.name]"
            ng-change="updateRole(role.name)"/>
          <label for="{{role.name}}"
            uib-popover="{{role.description}}"
            popover-animation="true"
            popover-placement="right"
            popover-trigger="'mouseenter'"
            >{{role.name}}</label>
        </div>
      </div>
      <div class="col-md-8">
        <table
          id="commandIndexTable"
          datatable="ng"
          dt-options="dtOptions"
          dt-instance="instanceCreated"
          class="table table-striped table-bordered"
          style="width: 100%">
          <thead>
            <tr>
              <th style="width: 10%;" scope="col">Garden</th>
              <th style="width: 10%;" scope="col">Namespace</th>
              <th style="width: 10%;" scope="col">Access</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="permission in selectedPermissions">
              <td>{{permission.garden}}</td>
              <td>{{permission.namespace}}</td>
              <td>{{permission.access}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row form-group">
      <div class="col-md-2">
        <input type="submit" class="btn btn-success w-100"
          ng-click="doCreate()"
          ng-show="hasPermission(user, 'ADMIN', is_local=true)"
          value="Create User" />
      </div>
      <div class="col-md-2">
        <input type="submit" class="btn btn-danger w-100"
          ng-click="doDelete(selectedUser.id)"
          ng-show="hasPermission(user, 'ADMIN', is_local=true)"
          confirm="Are you sure you want to remove this user?"
          value="Remove User" />
      </div>

    </div>
  </form>

  <div uib-alert
       ng-repeat="alert in alerts"
       ng-class="'alert-' + alert.type"
       close="closeAlert($index)">
    {{alert.msg}}
  </div>
</div>
